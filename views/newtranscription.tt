<h2>New transcription</h2>
<hr/>
<form class="form-horizontal" role="form" action="/transcriptions/update" method="POST">
  <div class="form-group">
    <label for="file" class="col-sm-2 control-label">Audio file</label>
    <div class="col-sm-10">
		<!-- The fileinput-button span is used to style the file input field as button -->
		<span id="fileupload-button" class="btn btn-default fileinput-button">
			<span class="glyphicon glyphicon-headphones"></span>
			<span>&nbsp;choose...</span>
			<!-- The file input field used as target for the file upload widget -->
			<input id="fileupload" type="file" name="file">
		</span>
		<div id="progress" class="progress" style="display: none;">
			<div class="progress-bar progress-bar-success"></div>
		</div>
		<div class="alert alert-success" id="fileupload-success-message" style="display: none;">upload completed</div>
 </div>
  </div>
  <div class="form-group">
    <label for="title" class="col-sm-2 control-label">Title</label>
    <div class="col-sm-10">
      <input type="text" class="form-control" id="title" name="title" placeholder="Leave blank if doubt">
    </div>
  </div>
  <div class="form-group">
    <label for="description" class="col-sm-2 control-label">Description</label>
    <div class="col-sm-10">
      <textarea class="form-control" id="description" name="description" placeholder="Leave blank if doubt"></textarea>
    </div>
  </div>
  <div class="form-group">
    <label for="shared" class="col-sm-2 control-label">Shared</label>
    <div class="col-sm-2">
      <input type="checkbox" id="shared" name="shared">
    </div>
  </div>
  <div class="form-group">
    <div class="col-sm-offset-2 col-sm-10">
      <button type="submit" class="btn btn-default">Save</button>
    </div>
  </div>
  <input id="utt" type="hidden" name="utt">
</form>

<script>
$(function () {
    'use strict';
    // Change this to the location of your server-side upload handler:
    $('#fileupload').fileupload({
        url: '/utterance/upload',
        dataType: 'json',
        start: function (e, data) {
			$('#fileupload-button').css('display', 'none');
			$('#progress .progress-bar').text('');
		    $('#progress').css('display', 'block');
        },
        done: function (e, data) {
			$('#progress').css('display', 'none');
            $('#progress .progress-bar').css('width', '0%');
			$('#fileupload-success-message')[0].innerHTML = data.result.filename + ' is uploaded and transcribed';
			$('#fileupload-success-message').css('display', 'block');
			$('#utt')[0].value = data.result.utt;
        },
        progressall: function (e, data) {
            var progress = parseInt(data.loaded / data.total * 100, 10);
            $('#progress .progress-bar').css(
                'width',
                progress + '%'
            );

			if (progress == 100) {
				$('#progress .progress-bar').text('Transcribing, please wait...');
			}
        }
    }).prop('disabled', !$.support.fileInput)
        .parent().addClass($.support.fileInput ? undefined : 'disabled');
});
</script>

